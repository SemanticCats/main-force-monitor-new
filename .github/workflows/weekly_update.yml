name: ğŸ”„ æ¯å‘¨æ›´æ–°é¾™å¤´è‚¡

on:
  schedule:
    # æ¯å‘¨ä¸€å‡Œæ™¨ 01:00 (åŒ—äº¬æ—¶é—´) è¿è¡Œ
    - cron: '0 1 * * 1'  
  workflow_dispatch:

jobs:
  run:
    runs-on: ubuntu-latest
    steps:
      # 1. æ£€å‡ºä»£ç  (å¿…é¡»)
      - uses: actions/checkout@v4

      # 2. è®¾ç½® Python ç¯å¢ƒ
      - uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      # 3. å®‰è£…ä¾èµ–åº“
      # ä½¿ç”¨æ¸…åæºåŠ é€Ÿä¸‹è½½
      - name: Install dependencies
        run: |
          pip install akshare pandas -i https://pypi.tuna.tsinghua.edu.cn/simple

      # 4. è¿è¡Œ Python è„šæœ¬
      # è¿™ä¸€æ­¥ä¼šç”Ÿæˆ auto_leaders.json æ–‡ä»¶
      - name: Run update script
        run: |
          python update_leaders.py

      # 5. æäº¤æ›´æ–°çš„æ–‡ä»¶ (å¦‚æœæœ‰çš„è¯)
      # ä¿®æ­£äº†ç¼©è¿›ï¼Œå¹¶æ·»åŠ äº†é”™è¯¯å¿½ç•¥ï¼Œé˜²æ­¢å› ä¸ºæ²¡æœ‰æ›´æ”¹è€ŒæŠ¥é”™
      - name: Commit and Push
        run: |
          git config --global user.email "actions@github.com"
          git config --global user.name "GitHub Actions"
          git add auto_leaders.json
          # åªæœ‰å½“æ–‡ä»¶æœ‰å˜åŒ–æ—¶æ‰æäº¤ï¼Œæˆ–è€…å¦‚æœæ²¡æœ‰å˜åŒ–ä¹Ÿä¸æŠ¥é”™
          if git diff --staged --quiet; then
            echo "No changes to commit"
          else
            git commit -m "Auto update leaders $(date)"
            git push
          fi
